!function(a,b,c,d){a.Bebop=a.Bebop||{};var e=Bebop.List=Backbone.View.extend({events:{'click > [bebop-list--el="form"] [bebop-list--formAction]':"doFormAction"},initialize:function(a){var b,f=this;this.$el=d(a.el),this.parentList=a.parentList,this.parentModel=a.parentModel;var g=this.$el.attr("bebop-list--config");if(this.$el.attr("bebop-list--config",null),this.config="inherit"==g?this.parentList.config:new Backbone.Model(g?JSON.parse(g):{}),this.$el.attr("bebop-media--config",null),this.$el.attr("bebop-list--mode",this.config.get("mode")),this.fieldName=this.config.get("field_name"),this.status=new Backbone.Model({isChildList:"inherit"==g,isChildList_v2:!1,dataContext:null,mode:this.config.get("mode"),view:"browse",insertPosition:null,empty:!1,isSortable:!0,templateEngine:"mustache",currentEvent:null}),this.config.get("childList")&&this.status.set("isChildList_v2",!0),this.status.get("isChildList_v2")&&this.parentList&&this.parentModel)this.parentModel.get(this.config.get("field_name"))&&(b=this.parentModel.get(this.config.get("field_name"))),this.collection=new e.Collection(b);else if(this.status.get("isChildList")&&this.parentList){b=this.$el.attr("bebop-list--data");var h=b.replace("context:","");this.status.set("dataContext",h);var i=this.parentModel.get(h);this.collection=new e.Collection(i),this.fieldName=h,this.$el.find('[bebop-list--el="data-container"]').attr("name",h)}else this.collection=new e.Collection,this.$dataInputs=this.$el.find("input"),_.each(this.$dataInputs,function(a){var b=d(a),c=b.val();c?this.collection.add(JSON.parse(c)):b.remove()},this);if(this.$title=d("<div>").attr("bebop-list--el","title"),!this.status.get("isChildList")&&this.config.get("title")&&this.$el.append(this.$title.text(this.config.get("title"))),this.$description=d("<div>").attr("bebop-list--el","description"),!this.status.get("isChildList")&&this.config.get("description")&&this.$el.append(this.$description.text(this.config.get("description"))),this.$topForm=d("<div>").attr("bebop-list--el","form").attr("bebop-list--formId","top").addClass("bebop-ui-clrfix"),this.$el.append(this.$topForm),this.$list=d("<ul>").attr("bebop-list--el","list"),this.$el.append(this.$list),this.$emptyStateIndicator=d("<div>").attr("bebop-list--el","empty-state-indicator").css("display","none").append('<input type="hidden"><span class="bebop-list--item-name">'+this.config.get("no_items_message")+"</span>"),this.$el.append(this.$emptyStateIndicator),this.$bottomForm=d("<div>").attr("bebop-list--el","form").attr("bebop-list--formId","bottom").addClass("bebop-ui-clrfix"),this.$el.append(this.$bottomForm),this.status.get("isChildList")&&this.parentList){this.collection.comparator=function(a,b){var c=f.$list.find('li[bebop-list--model-id="'+a.cid+'"]').index(),d=f.$list.find('li[bebop-list--model-id="'+b.cid+'"]').index();return c<d?-1:c>d?1:0},this.itemTemplates=this.parentList.itemTemplates,this.formTemplates=this.parentList.formTemplates;var j=this.status.get("dataContext");this.formTemplates.main=this.formTemplates[j]!==c?this.formTemplates[j]:this.formTemplates.default,this.itemTemplates.main=d("<div>").html(this.itemTemplates.main).find('[bebop-list--el="data-container"]').attr("name",this.fieldName).end().html()}else{this.status.get("isChildList_v2")&&this.parentList&&(this.collection.comparator=function(a,b){var c=f.$list.find('li[bebop-list--model-id="'+a.cid+'"]').index(),d=f.$list.find('li[bebop-list--model-id="'+b.cid+'"]').index();return c<d?-1:c>d?1:0});var k=d("#bebop-list--"+this.config.get("field_name")+"-templates-container");this.formTemplates={},$formTemplates=k.find("[bebop-list--formTemplate]"),this.formTemplates={},_.each($formTemplates,function(a,b){var c=d(a),e=c.attr("bebop-list--formTemplate");e&&(this.formTemplates[e]=c.html().trim())},this),""===this.formTemplates.main&&(this.formTemplates.main=this.formTemplates.default),$itemTemplates=k.find("[bebop-list--itemTemplate]"),this.itemTemplates={},_.each($itemTemplates,function(a,b){var c=d(a),e=c.attr("bebop-list--itemTemplate");if(e){var f;f="main"==e?c.clone().find('[bebop-list--el="data-container"]').attr("name",this.fieldName).end().html():c.html(),this.itemTemplates[e]=f.trim()}},this)}this.$topForm.html(this.formTemplates.main),this.$bottomForm.html(this.formTemplates.main),this.$form=this.$el.find('[bebop-list--el="form"]'),this.buttons={},_.each(this.$form,function(a,b){var c=d(a),e=c.attr("bebop-list--formId"),f=c.find("[bebop-list--formAction]");_.each(f,function(a,b){var c=d(a);buttonId=c.attr("bebop-list--formElId"),d.isArray(this.buttons[buttonId])||(this.buttons[buttonId]=[]),this.buttons[buttonId].push({$el:c,formId:e})},this)},this),this.handleEmptyIndicator=function(){f.status.hasChanged("empty")&&(f.status.get("empty")?f.$emptyStateIndicator.find("input").attr("name",f.fieldName).end().slideDown(200):f.$emptyStateIndicator.find("input").attr("name","").end().slideUp(200))},this.listenTo(this.status,"change:empty",this.handleEmptyIndicator),0===this.collection.length&&this.status.set("empty",!0),this.collection.on("add",function(a){var b=this.status.get("insertPosition");"append"==b?this.appendItem(a):"prepend"==b&&this.prependItem(a),1==this.collection.length&&this.status.set("empty",!1),this.status.get("isChildList")&&(this.collection.sort(),this.collection.trigger("updateParentCollection")),this.status.get("isChildList_v2")&&(this.collection.sort(),this.collection.trigger("updateParentCollection_v2"))},this),this.collection.on("remove",function(a){0===this.collection.length&&this.status.set("empty",!0)},this),this.parentList&&this.parentModel&&(this.collection.on("updateParentCollection",function(){this.parentModel.set(this.status.get("dataContext"),this.collection.toJSON())},this),this.collection.on("updateParentCollection_v2",function(){this.parentModel.set(this.config.get("field_name"),this.collection.toJSON())},this)),"true"==this.$list.attr("bebop-list--is-sortable")&&this.status.set("isSortable",!0);var l=this.config.get("file_upload");null!==l&&(this.isMode("gallery")?(this.mediaPicker=wp.media({frame:"select",multiple:l.config.modal_select_multiple,title:l.config.modal_title,library:{type:l.config.mime_types},button:{text:l.config.modal_button_text}}),this.mediaPicker.on("select",function(){var a=this.mediaPicker.state().get("selection").toJSON();_.each(a,function(a,b,c){this.collection.add(new e.ItemModel({id:a.id,view:this.status.get("view"),mode:this.status.get("mode")}))},this)},this)):(this.interalSourceMediaPicker=wp.media({frame:"select",multiple:l.config.modal_select_multiple,title:l.config.modal_title,library:{type:l.config.mime_types},button:{text:l.config.modal_button_text}}),this.interalSourceMediaPicker.on("select",function(){var a=this.interalSourceMediaPicker.state().get("selection").toJSON();_.each(a,function(a,b,c){this.collection.add(new e.ItemModel({id:a.id,view:"browse",source_id:"internal"}))},this)},this))),this.status.on("change:view",function(){this.refresh()},this),this.$list.sortable({handle:".bebop-list--drag-handle",placeholder:"bebop-list--item-placeholder bebop-ui-icon-target"}),this.status.get("isChildList")&&this.$list.on("sortstop",function(a,b){f.collection.sort(),f.collection.trigger("updateParentCollection")}),this.status.get("isChildList_v2")&&this.$list.on("sortstop",function(a,b){f.collection.sort(),f.collection.trigger("updateParentCollection_v2")}),this.render()},doFormAction:function(a){a.preventDefault();var b=d(a.currentTarget).attr("bebop-list--formAction");this.status.set("currentEvent",a),this["formAction_"+b]!==c&&this["formAction_"+b](a)},isMode:function(a){return this.status.get("mode")==a},formAction_toggleReorder:function(a){"reorder"!=this.status.get("view")?(this.status.set("view","reorder"),_.each(this.buttons.editAll,function(a){a.$el.removeClass("is-enabled").find("b").text("Edit All").end().find("span").removeClass("bebop-ui-icon-save").addClass("bebop-ui-icon-edit")}),_.each(this.buttons.sort,function(a){a.$el.addClass("is-enabled")})):(this.status.set("view","browse"),_.each(this.buttons.sort,function(a){a.$el.removeClass("is-enabled")}))},formAction_toggleEditAll:function(a){"edit"!=this.status.get("view")?(this.status.set("view","edit"),_.each(this.buttons.sort,function(a){a.$el.removeClass("is-enabled")}),_.each(this.buttons.editAll,function(a){a.$el.addClass("is-enabled").find("b").text("Save All").end().find("span").removeClass("bebop-ui-icon-edit").addClass("bebop-ui-icon-save")})):(this.status.set("view","browse"),_.each(this.buttons.editAll,function(a){a.$el.removeClass("is-enabled").find("b").text("Edit All").end().find("span").removeClass("bebop-ui-icon-save").addClass("bebop-ui-icon-edit")}))},formAction_insertItem:function(a){this.addNewitem()},addNewitem:function(a){if(this.setInsertPosition(),this.isMaxItemsReached())return void this.displayMaxItemsReachedMessage();a||(a={}),this.isMode("gallery")?this.mediaPicker.open():this.addNewModel(a)},addNewInternalMediaitem:function(){this.setInsertPosition(),this.interalSourceMediaPicker.open()},setInsertPosition:function(){var a=this.status.get("currentEvent"),b=d(a.currentTarget).parents('[bebop-list--el="form"]'),c="top"==b.attr("bebop-list--formId")?"prepend":"append";this.status.set("insertPosition",c)},getNewItemView:function(a){return new e.ItemView({model:a,templates:this.itemTemplates,fieldName:this.fieldName,mode:this.status.get("mode"),list:this,dataContext:this.status.get("dataContext")})},addNewModel:function(a){a||(a={}),a.view===c&&(a.view="edit"),this.collection.add(new e.ItemModel(a))},prependItem:function(a){var b=this.getNewItemView(a);this.$list.prepend(b.render().el)},appendItem:function(a){var b=this.getNewItemView(a);this.$list.append(b.render().el)},isMaxItemsReached:function(){var a=this.config.get("max_items");return!!(a&&a>0&&a<=this.collection.length)},displayMaxItemsReachedMessage:function(){var a=this.config.get("max_items"),b=this.config.get("max_items_message"),c=b||"You've reached the maximum number of allowed items: "+a,e=d("<div>").attr("bebop-list--message",!0).text(c);"prepend"==this.status.get("insertPosition")?(e.addClass("is-top"),this.$list.before(e)):(e.addClass("is-bottom"),this.$list.after(e)),e.delay(3e3).slideUp(250,function(){d(this).remove()})},refresh:function(){var a=(this.status.previous("view"),this.status.get("view"));this.collection.each(function(b){b.set("view",a)},this)},render:function(){return this.collection.each(function(a,b){this.appendItem(a),this.$dataInputs!==c&&this.$dataInputs.length>=1&&this.$dataInputs.get(b).remove()},this),Bebop.Modules.init({container:this.$form}),this}});e.addFormAction=function(a,b){var c="formAction_"+a;this.prototype[c]=b}}(window,document,void 0,jQuery||$),function(a,b,c,d){a.Bebop=a.Bebop||{};var e=Bebop.List||{},f=e.ItemView=Backbone.View.extend({tagName:"li",className:"bebop-list--item",events:{'click > [bebop-list--el="item-actions"] [bebop-list--action]':"doAction",'change > [bebop-list--el="content"] [bebop-ui--field]':"updateSingle",'keyup > [bebop-list--el="content"] [bebop-ui--field]':"updateSingle"},initialize:function(a){this.list=a.list,this.dataContext=a.dataContext?a.dataContext:"",this.$el.attr("bebop-list--model-id",this.model.cid),this.$el.html(a.templates.main),this.$content=this.$el.find('[bebop-list--el="content"]'),this.buttons={edit:{$el:this.$el.find('[bebop-list--action="edit"]')},remove:{$el:this.$el.find('[bebop-list--action="remove"]')}},this.fields={},this.views={};var b=this.dataContext?this.dataContext+".browse":"browse",d=this.dataContext?this.dataContext+".edit":"edit",e=this.dataContext?this.dataContext+".reorder":"reorder";this.views.browse={$el:this.$el.find('[bebop-list--view="browse"]'),template:a.templates[b]},this.views.edit={$el:this.$el.find('[bebop-list--view="edit"]'),template:a.templates[d],cleanHTML:a.templates[d].replace(/\{\{[^\}]*\}\}/g,"")},this.views.reorder={$el:this.$el.find('[bebop-list--view="reorder"]'),template:a.templates[e]===c||""===a.templates[e]?a.templates[b]:a.templates[e]},this.$dataContainer=this.$el.find('[bebop-list--el="data-container"]'),this.$dataContainer.attr("name",a.fieldName+"[]"),this.mode=a.mode?a.mode:null,"gallery"==this.mode&&(this.image=new Bebop.Media({el:this.$el.find('[bebop-media--el="container"]'),id:this.model.get("id")}),this.image.status.on("change:data",function(){this.render()},this)),this.storeData(),this.listenTo(this.model,"change",this.storeData),this.listenTo(this.model,"change:view",this.render),this.listenTo(this.model,"destroy",this.destroy)},doAction:function(a){a.preventDefault();var b=d(a.currentTarget).attr("bebop-list--action");this[b]!==c&&this[b](a)},edit:function(){this.model.set("view","edit")},browse:function(){this.model.set("view","browse")},reorder:function(){this.model.set("view","reorder")},updateSingle:function(a){var b=d(a.currentTarget).attr("bebop-ui--field");this.model.set(b,this.getFieldValue(b)),this.list.status.get("isChildList")&&this.list.collection.trigger("updateParentCollection"),this.list.status.get("isChildList_v2")&&this.list.collection.trigger("updateParentCollection_v2")},update:function(){_.each(this.views.edit.fields,function(a,b){this.model.set(b,this.getFieldValue(b))},this),this.list.status.get("isChildList")&&this.list.collection.trigger("updateParentCollection"),this.list.status.get("isChildList_v2")&&this.list.collection.trigger("updateParentCollection_v2")},storeData:function(){var a=_.clone(this.model.attributes);delete a.view,delete a.mode,this.$dataContainer.val(JSON.stringify(a))},remove:function(){this.model.destroy(),this.list.status.get("isChildList")&&this.list.collection.trigger("updateParentCollection"),this.list.status.get("isChildList_v2")&&this.list.collection.trigger("updateParentCollection_v2")},destroy:function(){this.$el.slideUp(250,function(){d(this).remove()})},prepareView:function(){var a=this.model.get("view");_.each(this.$content.find('[name]:not([name^="___bebop-ui--placeholder-"])'),function(a,b){var c=d(a),e=c.attr("name"),f=c.attr("type");if(newName="radio"==f||"checkbox"==f?"___bebop-ui--placeholder-"+e:null,c.attr("name",newName).attr("bebop-ui--field",e),this.fields[e]={$el:c,tagName:c.get(0).tagName,type:c.attr("type")},!this.model.has(e)){var g="";"INPUT"==c.get(0).tagName&&(g="checkbox"!=c.attr("type")||c.is(":checked")?c.val():""),"SELECT"==c.get(0).tagName&&($options=c.find("option:selected"),c.attr("multiple")?(g=[],_.each($options,function(a,b,c){g[b]=d(a).val()},this)):g=$options.val()),this.model.set(e,g)}},this),"edit"==a?(this.buttons.edit.$el.attr("bebop-list--action","browse").find("b").text("Save").end().find("span").removeClass("bebop-ui-icon-edit").addClass("bebop-ui-icon-save"),this.buttons.remove.$el.attr("disabled",!0)):(this.buttons.edit.$el.attr("bebop-list--action","edit").find("b").text("Edit").end().find("span").removeClass("bebop-ui-icon-save").addClass("bebop-ui-icon-edit"),this.buttons.remove.$el.prop("disabled",!1)),"reorder"==a?this.buttons.edit.$el.prop("disabled",!0):this.buttons.edit.$el.prop("disabled",!1)},getFieldValue:function(a){var b=this.views[this.model.get("view")].$el,c=b.find('[bebop-ui--field="'+a+'"]'),e="";switch(c.get(0).tagName){case"INPUT":"checkbox"==c.attr("type")?c.length>1?(e=[],_.each(c,function(a,b){var c=d(a);c.is(":checked")&&e.push(c.val())})):e=c.is(":checked")?c.val():"":"radio"==c.attr("type")?c.length>1?(e="",_.each(c,function(a,b){var c=d(a);c.is(":checked")&&(e=c.val())})):e=c.is(":checked")?c.val():"":e=c.val();break;case"SELECT":c.attr("multiple")?(e=[],_.each(c.find("option:selected"),function(a,b){e[b]=d(a).val()})):e=c.find("option:selected").val();break;default:e=c.val()}return e},getPrettyValue:function(a,b){if("view"==a)return b;var c=[];c[a]=b;var e=d(Mustache.render(this.views.browse.cleanHTML,c)).find('[name="'+a+'"]');return e.length>0&&"SELECT"==e.get(0).tagName&&(b=b?e.find('option[value="'+b+'"]').text():b),b},getTemplateData:function(){var a=this.model.get("view"),b=_.clone(this.model.attributes);return _.each(b,function(c,d){d.indexOf("[]")>-1&&(delete b[d],d=d.replace("[]",""),b[d]=c),c instanceof Array?_.each(c,function(c,e,f){"edit"!=a&&(b[d][e]=this.getPrettyValue(d,c)),b[d+"_has_"+c]=!0},this):("edit"!=a&&(b[d]=this.getPrettyValue(d,c)),b[d+"_is_"+c]=!0)},this),"gallery"==this.mode&&(b.image=this.image.status.get("data")),b},render:function(){this.model.hasChanged("view")&&"edit"==this.model.previous("view")&&this.update();var a=this.model.previous("view"),b=this.model.get("view"),c=Mustache.render(this.views[b].template,this.getTemplateData());return this.$el.removeClass("view--"+a).addClass("view--"+b),this.views[b].$el.html(c),this.prepareView(),this.views[b].$el.show().siblings("[bebop-list--view]").hide(),this.$el.is(":visible")||this.$el.slideDown(200),_.each(this.views[b].$el.find('[bebop-list--el="container"]'),function(a,b){new Bebop.List({el:a,parentList:this.list,parentModel:this.model})},this),_.each(this.views[b].$el.find('[bebop-media--el="container"]'),function(a,b){new Bebop.Media({el:a})},this),Bebop.Modules.init({container:this.views[b].$el}),this.afterRenderFns.length>0&&_.each(this.afterRenderFns,function(a){a(this)},this),this},afterRender:function(a){}});f.prototype.afterRenderFns=[],f.onRendered=function(a){_.isFunction(a)&&this.prototype.afterRenderFns.push(a)}}(window,document,void 0,jQuery||$),function(a,b,c,d){a.Bebop=a.Bebop||{};var e=Bebop.List||{};e.ItemModel=Backbone.Model.extend({idAttribute:"_id",defaults:{view:"browse"},sync:function(){return!1}})}(window,document,0,jQuery||$),function(a,b,c,d){a.Bebop=a.Bebop||{};var e=Bebop.List||{};e.Collection=Backbone.Collection.extend({model:e.ItemModel,sync:function(){return!1}})}(window,document,0,jQuery||$),function(a,b,c,d){d(function(){d.each(d('[bebop-list--el="container"]'),function(a,b){new Bebop.List({el:b})}),Bebop.List.addFormAction("bebop-ui-action--addAssociatedType",function(a){var b=d(a.currentTarget).parents("[bebop-list--formelementid]").find('[bebop-list--formElId="selector"]');id=b.val(),id||-1==id?(this.addNewitem({id:id,view:"browse"}),b.val("").trigger("change")):alert("You need to select an item")}),Bebop.List.addFormAction("bebop-ui-action--addSection",function(a){var b=d(a.currentTarget).parents("[bebop-list--formelementid]").find('[bebop-list--formElId="selector"]');id=b.val(),id?this.addNewitem({type:id,type_title:b.find("option[value="+id+"]").text(),view:"edit"}):alert("You need to select an option from the dropdown")}),Bebop.List.addFormAction("bebop-ui-action--addMediaFromTargetSource",function(a){var b=d(a.currentTarget).parents("[bebop-list--formelementid]").find('[bebop-list--formElId="selector"]');id=b.val(),id&&-1!=id?"internal"==id?this.addNewInternalMediaitem():this.addNewitem({source_id:id,source_name:b.find("option[value="+id+"]").text(),view:"browse"}):alert("You need to select a media source")})})}(window,document,0,jQuery||$);