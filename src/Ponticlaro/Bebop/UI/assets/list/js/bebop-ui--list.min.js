!function(a,b,c,d){a.Bebop=a.Bebop||{};var e=Bebop.List=Backbone.View.extend({events:{'click > [bebop-list--el="form"] [bebop-list--formAction]':"doFormAction"},initialize:function(a){var b,f=this;this.$el=d(a.el),this.parentList=a.parentList,this.parentModel=a.parentModel;var g=this.$el.attr("bebop-list--config");if(this.$el.attr("bebop-list--config",null),this.config="inherit"==g?this.parentList.config:new Backbone.Model(g?JSON.parse(g):{}),this.$el.attr("bebop-media--config",null),this.$el.attr("bebop-list--mode",this.config.get("mode")),this.fieldName=this.config.get("field_name"),this.status=new Backbone.Model({isChildList:"inherit"==g?!0:!1,dataContext:null,mode:this.config.get("mode"),view:"browse",insertPosition:null,empty:!1,isSortable:!0,templateEngine:"mustache",currentEvent:null}),this.status.get("isChildList")&&this.parentList){b=this.$el.attr("bebop-list--data");var h=b.replace("context:","");this.status.set("dataContext",h);var i=this.parentModel.get(h);this.collection=new e.Collection(i),this.fieldName=h,this.$el.find('[bebop-list--el="data-container"]').attr("name",h)}else this.collection=new e.Collection,this.$dataInputs=this.$el.find("input"),_.each(this.$dataInputs,function(a){var b=d(a),c=b.val();c?this.collection.add(JSON.parse(c)):b.remove()},this);if(this.$title=d("<div>").attr("bebop-list--el","title"),!this.status.get("isChildList")&&this.config.get("title")&&this.$el.append(this.$title.text(this.config.get("title"))),this.$description=d("<div>").attr("bebop-list--el","description"),!this.status.get("isChildList")&&this.config.get("description")&&this.$el.append(this.$description.text(this.config.get("description"))),this.$topForm=d("<div>").attr("bebop-list--el","form").attr("bebop-list--formId","top").addClass("bebop-ui-clrfix"),this.$el.append(this.$topForm),this.$list=d("<ul>").attr("bebop-list--el","list"),this.$el.append(this.$list),this.$emptyStateIndicator=d("<div>").attr("bebop-list--el","empty-state-indicator").css("display","none").append('<input type="hidden"><span class="bebop-list--item-name">No items added until now</span>'),this.$el.append(this.$emptyStateIndicator),this.$bottomForm=d("<div>").attr("bebop-list--el","form").attr("bebop-list--formId","bottom").addClass("bebop-ui-clrfix"),this.$el.append(this.$bottomForm),this.status.get("isChildList")&&this.parentList){this.collection.comparator=function(a,b){var c=f.$list.find('li[bebop-list--model-id="'+a.cid+'"]').index(),d=f.$list.find('li[bebop-list--model-id="'+b.cid+'"]').index();return d>c?-1:c>d?1:0},this.itemTemplates=this.parentList.itemTemplates,this.formTemplates=this.parentList.formTemplates;var j=this.status.get("dataContext");this.formTemplates.main=this.formTemplates[j]!==c?this.formTemplates[j]:this.formTemplates["default"],this.itemTemplates.main=d("<div>").html(this.itemTemplates.main).find('[bebop-list--el="data-container"]').attr("name",this.fieldName).end().html()}else{var k=d("#bebop-list--"+this.config.get("field_name")+"-templates-container");this.formTemplates={},$formTemplates=k.find("[bebop-list--formTemplate]"),this.formTemplates={},_.each($formTemplates,function(a){var b=d(a),c=b.attr("bebop-list--formTemplate");c&&(this.formTemplates[c]=b.html().trim()),b.remove()},this),""===this.formTemplates.main&&(this.formTemplates.main=this.formTemplates["default"]),$itemTemplates=k.find("[bebop-list--itemTemplate]"),this.itemTemplates={},_.each($itemTemplates,function(a){var b=d(a),c=b.attr("bebop-list--itemTemplate");if(c){var e;e="main"==c?b.clone().find('[bebop-list--el="data-container"]').attr("name",this.fieldName).end().html():b.html(),this.itemTemplates[c]=e.trim()}b.remove()},this),k.remove()}this.$topForm.html(this.formTemplates.main),this.$bottomForm.html(this.formTemplates.main),this.$form=this.$el.find('[bebop-list--el="form"]'),this.buttons={},_.each(this.$form,function(a){var b=d(a),c=b.attr("bebop-list--formId"),e=b.find("[bebop-list--formAction]");_.each(e,function(a){var b=d(a);buttonId=b.attr("bebop-list--formElId"),d.isArray(this.buttons[buttonId])||(this.buttons[buttonId]=[]),this.buttons[buttonId].push({$el:b,formId:c})},this)},this),this.handleEmptyIndicator=function(){f.status.hasChanged("empty")&&(f.status.get("empty")?f.$emptyStateIndicator.find("input").attr("name",f.fieldName).end().slideDown(200):f.$emptyStateIndicator.find("input").attr("name","").end().slideUp(200))},this.listenTo(this.status,"change:empty",this.handleEmptyIndicator),0===this.collection.length&&this.status.set("empty",!0),this.collection.on("add",function(a){var b=this.status.get("insertPosition");"append"==b?this.appendItem(a):"prepend"==b&&this.prependItem(a),1==this.collection.length&&this.status.set("empty",!1),this.status.get("isChildList")&&(this.collection.sort(),this.collection.trigger("updateParentCollection"))},this),this.collection.on("remove",function(){0===this.collection.length&&this.status.set("empty",!0)},this),this.parentList&&this.parentModel&&this.collection.on("updateParentCollection",function(){this.parentModel.set(this.status.get("dataContext"),this.collection.toJSON())},this),"true"==this.$list.attr("bebop-list--is-sortable")&&this.status.set("isSortable",!0),this.isMode("gallery")&&(this.mediaPicker=wp.media({frame:"select",multiple:!0,title:"Upload or select existing resources",library:{type:"image"},button:{text:"Add images"}}),this.mediaPicker.on("select",function(){var a=this.mediaPicker.state().get("selection").toJSON();_.each(a,function(a){"image"==a.type&&this.collection.add(new e.ItemModel({id:a.id,view:this.status.get("view"),mode:this.status.get("mode")}))},this)},this)),this.status.on("change:view",function(){this.refresh()},this),this.$list.sortable({handle:".bebop-list--drag-handle",placeholder:"bebop-list--item-placeholder bebop-ui-icon-target"}),this.status.get("isChildList")&&this.$list.on("sortstop",function(){f.collection.sort(),f.collection.trigger("updateParentCollection")}),this.render()},doFormAction:function(a){a.preventDefault();var b=d(a.currentTarget).attr("bebop-list--formAction");this.status.set("currentEvent",a),this["formAction_"+b]!==c&&this["formAction_"+b](a)},isMode:function(a){return this.status.get("mode")==a?!0:!1},formAction_toggleReorder:function(){"reorder"!=this.status.get("view")?(this.status.set("view","reorder"),_.each(this.buttons.editAll,function(a){a.$el.removeClass("is-enabled").find("b").text("Edit All").end().find("span").removeClass("bebop-ui-icon-save").addClass("bebop-ui-icon-edit")}),_.each(this.buttons.sort,function(a){a.$el.addClass("is-enabled")})):(this.status.set("view","browse"),_.each(this.buttons.sort,function(a){a.$el.removeClass("is-enabled")}))},formAction_toggleEditAll:function(){"edit"!=this.status.get("view")?(this.status.set("view","edit"),_.each(this.buttons.sort,function(a){a.$el.removeClass("is-enabled")}),_.each(this.buttons.editAll,function(a){a.$el.addClass("is-enabled").find("b").text("Save All").end().find("span").removeClass("bebop-ui-icon-edit").addClass("bebop-ui-icon-save")})):(this.status.set("view","browse"),_.each(this.buttons.editAll,function(a){a.$el.removeClass("is-enabled").find("b").text("Edit All").end().find("span").removeClass("bebop-ui-icon-save").addClass("bebop-ui-icon-edit")}))},formAction_insertItem:function(){this.addNewitem()},addNewitem:function(a){this.setInsertPosition(),a||(a={}),this.isMode("gallery")?this.mediaPicker.open():this.addNewModel(a)},setInsertPosition:function(){var a=this.status.get("currentEvent"),b=d(a.currentTarget).parents('[bebop-list--el="form"]'),c="top"==b.attr("bebop-list--formId")?"prepend":"append";this.status.set("insertPosition",c)},getNewItemView:function(a){return new e.ItemView({model:a,templates:this.itemTemplates,fieldName:this.fieldName,mode:this.status.get("mode"),list:this,dataContext:this.status.get("dataContext")})},addNewModel:function(a){a||(a={}),a.view===c&&(a.view="edit"),this.collection.add(new e.ItemModel(a))},prependItem:function(a){var b=this.getNewItemView(a);this.$list.prepend(b.render().el)},appendItem:function(a){var b=this.getNewItemView(a);this.$list.append(b.render().el)},refresh:function(){var a=(this.status.previous("view"),this.status.get("view"));this.collection.each(function(b){b.set("view",a)},this)},render:function(){return this.collection.each(function(a,b){this.appendItem(a),this.$dataInputs!==c&&this.$dataInputs.length>=1&&this.$dataInputs.get(b).remove()},this),this}});e.addFormAction=function(a,b){var c="formAction_"+a;this.prototype[c]=b}}(window,document,void 0,jQuery||$),function(a,b,c,d){a.Bebop=a.Bebop||{};var e=Bebop.List||{},f=e.ItemView=Backbone.View.extend({tagName:"li",className:"bebop-list--item",events:{'click > [bebop-list--el="item-actions"] [bebop-list--action]':"doAction",'change > [bebop-list--el="content"] [bebop-ui--field]':"updateSingle",'keyup > [bebop-list--el="content"] [bebop-ui--field]':"updateSingle"},initialize:function(a){this.list=a.list,this.dataContext=a.dataContext?a.dataContext:"",this.$el.attr("bebop-list--model-id",this.model.cid),this.$el.html(a.templates.main),this.$content=this.$el.find('[bebop-list--el="content"]'),this.buttons={edit:{$el:this.$el.find('[bebop-list--action="edit"]')},remove:{$el:this.$el.find('[bebop-list--action="remove"]')}},this.fields={},this.views={};var b=this.dataContext?this.dataContext+".browse":"browse",d=this.dataContext?this.dataContext+".edit":"edit",e=this.dataContext?this.dataContext+".reorder":"reorder";this.views.browse={$el:this.$el.find('[bebop-list--view="browse"]'),template:a.templates[b]},this.views.edit={$el:this.$el.find('[bebop-list--view="edit"]'),template:a.templates[d],cleanHTML:a.templates[d].replace(/\{\{[^\}]*\}\}/g,"")},this.views.reorder={$el:this.$el.find('[bebop-list--view="reorder"]'),template:a.templates[e]===c||""===a.templates[e]?a.templates[b]:a.templates[e]},this.$dataContainer=this.$el.find('[bebop-list--el="data-container"]'),this.$dataContainer.attr("name",a.fieldName+"[]"),this.mode=a.mode?a.mode:null,"gallery"==this.mode&&(this.image=new Bebop.Media({el:this.$el.find('[bebop-media--el="container"]'),id:this.model.get("id")}),this.image.status.on("change:data",function(){this.render()},this)),this.storeData(),this.listenTo(this.model,"change",this.storeData),this.listenTo(this.model,"change:view",this.render),this.listenTo(this.model,"destroy",this.destroy)},doAction:function(a){a.preventDefault();var b=d(a.currentTarget).attr("bebop-list--action");this[b]!==c&&this[b](a)},edit:function(){this.model.set("view","edit")},browse:function(){this.model.set("view","browse")},reorder:function(){this.model.set("view","reorder")},updateSingle:function(a){var b=d(a.currentTarget).attr("bebop-ui--field");this.model.set(b,this.getFieldValue(b)),this.list.status.get("isChildList")&&this.list.collection.trigger("updateParentCollection")},update:function(){_.each(this.views.edit.fields,function(a,b){this.model.set(b,this.getFieldValue(b))},this),this.list.status.get("isChildList")&&this.list.collection.trigger("updateParentCollection")},storeData:function(){var a=_.clone(this.model.attributes);delete a.view,delete a.mode,this.$dataContainer.val(JSON.stringify(a))},remove:function(){this.model.destroy(),this.list.status.get("isChildList")&&this.list.collection.trigger("updateParentCollection")},destroy:function(){this.$el.slideUp(250,function(){d(this).remove()})},prepareView:function(){var a=this.model.get("view");_.each(this.$content.find('[name]:not([name^="___bebop-ui--placeholder-"])'),function(a){var b=d(a),c=b.attr("name"),e=b.attr("type");if(newName="radio"==e||"checkbox"==e?"___bebop-ui--placeholder-"+c:null,b.attr("name",newName).attr("bebop-ui--field",c),this.fields[c]={$el:b,tagName:b.get(0).tagName,type:b.attr("type")},!this.model.has(c)){var f="";"INPUT"==b.get(0).tagName&&(f="checkbox"!=b.attr("type")||b.is(":checked")?b.val():""),"SELECT"==b.get(0).tagName&&($options=b.find("option:selected"),b.attr("multiple")?(f=[],_.each($selected_options,function(a,b){f[b]=d(a).val()},this)):f=$options.val()),this.model.set(c,f)}},this),"edit"==a?(this.buttons.edit.$el.attr("bebop-list--action","browse").find("b").text("Save").end().find("span").removeClass("bebop-ui-icon-edit").addClass("bebop-ui-icon-save"),this.buttons.remove.$el.attr("disabled",!0)):(this.buttons.edit.$el.attr("bebop-list--action","edit").find("b").text("Edit").end().find("span").removeClass("bebop-ui-icon-save").addClass("bebop-ui-icon-edit"),this.buttons.remove.$el.prop("disabled",!1)),"reorder"==a?this.buttons.edit.$el.prop("disabled",!0):this.buttons.edit.$el.prop("disabled",!1)},getFieldValue:function(a){var b=this.$content.find('[bebop-ui--field="'+a+'"]');switch(b.get(0).tagName){case"INPUT":"checkbox"==b.attr("type")?value=b.is(":checked")?b.val():"":"radio"==b.attr("type")?b.length>1?(value="",_.each(b,function(a){var b=d(a);b.is(":checked")&&(value=b.val())})):value=b.is(":checked")?b.val():"":value=b.val();break;case"SELECT":b.attr("multiple")?(value=[],_.each(b.find("option:selected"),function(a,b){value[b]=d(a).val()})):value=b.find("option:selected").val();break;default:value=b.val()}return value},getPrettyValue:function(a,b){if("view"==a)return b;var c=d("<div>").html(this.views.edit.cleanHTML).find('[name="'+a+'"]');return c.length>0&&"SELECT"==c.get(0).tagName&&(b=b?c.find('option[value="'+b+'"]').text():b),b},getTemplateData:function(){var a=this.model.get("view"),b=_.clone(this.model.attributes);return _.each(b,function(c,d){c instanceof Array?_.each(c,function(a){b[d+"_has_"+a]=!0},this):("edit"!=a&&(b[d]=this.getPrettyValue(d,c)),b[d+"_is_"+c]=!0)},this),"gallery"==this.mode&&(b.image=this.image.status.get("data")),b},render:function(){this.model.hasChanged("view")&&"edit"==this.model.previous("view")&&this.update();var a=this.model.previous("view"),b=this.model.get("view"),c=Mustache.render(this.views[b].template,this.getTemplateData());return this.$el.removeClass("view--"+a).addClass("view--"+b),this.views[b].$el.html(c),this.prepareView(),this.views[b].$el.show().siblings("[bebop-list--view]").hide(),this.$el.is(":visible")||this.$el.slideDown(200),_.each(this.views[b].$el.find('[bebop-list--el="container"]'),function(a){new Bebop.List({el:a,parentList:this.list,parentModel:this.model})},this),_.each(this.views[b].$el.find('[bebop-media--el="container"]'),function(a){new Bebop.Media({el:a})},this),this.afterRenderFns.length>0&&_.each(this.afterRenderFns,function(a){a(this)},this),this},afterRender:function(){}});f.prototype.afterRenderFns=[],f.onRendered=function(a){_.isFunction(a)&&this.prototype.afterRenderFns.push(a)}}(window,document,void 0,jQuery||$),function(a){a.Bebop=a.Bebop||{};{var b=Bebop.List||{};b.ItemModel=Backbone.Model.extend({idAttribute:"_id",defaults:{view:"browse"},sync:function(){return!1}})}}(window,document,void 0,jQuery||$),function(a){a.Bebop=a.Bebop||{};{var b=Bebop.List||{};b.Collection=Backbone.Collection.extend({model:b.ItemModel,sync:function(){return!1}})}}(window,document,void 0,jQuery||$),function(a,b,c,d){d(function(){d.each(d('[bebop-list--el="container"]'),function(a,b){new Bebop.List({el:b})})})}(window,document,void 0,jQuery||$);